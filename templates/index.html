<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Doküman Yönetim Sistemi</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    .admin-menu h4 {
      margin-top: 0;
    }
    /* Yeni eklenen sınıf: admin-card */
    .admin-card {
      margin-top: 30px;  /* Bu değeri başlığın hizasına göre ayarlayabilirsiniz */
    }
    .admin-menu a.btn {
      display: block;
      margin-bottom: 10px;
    }
    .flashes .alert {
      margin: 20px 0;
      padding: 15px;
      border-radius: 4px;
      position: relative;
    }
    .flashes .close {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
    }
    .pagination .page-item.disabled .page-link {
      pointer-events: none;
      opacity: 0.6;
    }
    .pagination .page-item.active .page-link {
      background-color: #007bff;
      border-color: #007bff;
      color: #fff;
    }
  </style>
</head>
<body>
  <div class="container-fluid">
    <div class="row">
      <!-- Sol Taraftaki Sütun -->
      <div class="col-md-3">
        {% if current_user.is_authenticated and current_user.role == 'admin' %}
          <!-- admin-menu kartı artık "admin-card" sınıfıyla aşağı kaydırılmış -->
          <div class="card mb-3 admin-card">
            <div class="card-header">
              <h5 class="mb-0">Admin Menüsü</h5>
            </div>
            <div class="card-body">
              <a href="{{ url_for('admin_upload_form') }}" class="btn btn-primary btn-block mb-2">Dosya Yükle</a>
              <a href="{{ url_for('admin_users') }}" class="btn btn-secondary btn-block mb-2">Kullanıcı Yönetimi</a>
              <a href="{{ url_for('manage_policy') }}" class="btn btn-info btn-block mb-2">Doküman Politikası Yönetimi</a>
            </div>
          </div>
        {% endif %}
      </div>
      
      <!-- Sağ Taraftaki Sütun: Doküman Listesi -->
      <div class="col-md-9">
        <!-- Flash Mesajları -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flashes">
              {% for category, message in messages %}
                <div class="alert alert-{{ category }}">
                  {{ message }}
                  <span class="close" onclick="this.parentElement.style.display='none'">&times;</span>
                </div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <h1 class="mb-4">Doküman Yönetim Sistemi</h1>

        <!-- Doküman Listesi -->
        <h2 class="mb-3">Dokümanlar</h2>
        {% if documents and documents|length > 0 %}
          <div class="table-responsive">
            <table class="table table-bordered table-hover">
              <thead class="thead-light">
                <tr>
                  <th>Dosya Adı</th>
                  <th>Açıklama</th>
                  <th>Yüklenme Tarihi</th>
                  <th>İşlemler</th>
                </tr>
              </thead>
              <tbody>
                {% for doc in documents %}
                  <tr>
                    <td>{{ doc['filename'] }}</td>
                    <td>{{ doc['description'] }}</td>
                    <td>{{ doc['upload_date'] }}</td>
                    <td>
                      <a href="{{ url_for('download_file', filename=doc['filename']) }}" class="btn btn-sm btn-success mr-2">İndir</a>
                      <a href="{{ url_for('preview_file', filename=doc['filename']) }}" class="btn btn-sm btn-info mr-2">Önizle</a>
                      {% if current_user.is_authenticated and current_user.role == 'admin' %}
                        <a href="{{ url_for('delete_file', filename=doc['filename']) }}" class="btn btn-sm btn-danger" onclick="return confirm('Bu dosyayı silmek istediğinize emin misiniz?')">Sil</a>
                      {% endif %}
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="alert alert-warning">
            Gösterilecek doküman bulunamadı.
          </div>
        {% endif %}

        <!-- Sayfalama (Pagination) -->
        {% if total_pages > 1 %}
          <nav aria-label="Sayfalama">
            <ul class="pagination">
              <li class="page-item {% if current_page <= 1 %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('documents', query=search_query, filter_category=filter_category, per_page=per_page, page=current_page-1) }}">‹</a>
              </li>
              {% for p in range(1, total_pages+1) %}
                <li class="page-item {% if p == current_page %}active{% endif %}">
                  <a class="page-link" href="{{ url_for('documents', query=search_query, filter_category=filter_category, per_page=per_page, page=p) }}">{{ p }}</a>
                </li>
              {% endfor %}
              <li class="page-item {% if current_page >= total_pages %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('documents', query=search_query, filter_category=filter_category, per_page=per_page, page=current_page+1) }}">›</a>
              </li>
            </ul>
          </nav>
        {% endif %}
      </div>
    </div>
  </div>
</body>
</html>
